<%- include('partials/header') %>

<!-- Products Page -->
<section class="page-header">
  <div class="container">
    <h1><i class="bi bi-shop me-2"></i>Our Products</h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item active">Products</li>
        <% if (typeof currentCategory !== 'undefined' && currentCategory) { %>
          <li class="breadcrumb-item active"><%= currentCategory %></li>
        <% } %>
      </ol>
    </nav>
  </div>
</section>

<section class="products-page section-padding">
  <div class="container">
    <div class="row">
      <!-- Filters Sidebar -->
      <div class="col-lg-3">
        <div class="filter-sidebar">
          <div class="filter-header d-flex justify-content-between align-items-center d-lg-none">
            <h5>Filters</h5>
            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse">
              <i class="bi bi-funnel"></i>
            </button>
          </div>
          <div class="collapse d-lg-block" id="filterCollapse">
            <!-- Search -->
            <div class="filter-group">
              <h6><i class="bi bi-search me-2"></i>Search</h6>
              <form action="/products" method="GET">
                <input type="text" name="search" class="form-control" placeholder="Search products..." 
                       value="<%= typeof currentSearch !== 'undefined' ? currentSearch : '' %>">
                <% if (typeof currentCategory !== 'undefined' && currentCategory) { %>
                  <input type="hidden" name="category" value="<%= currentCategory %>">
                <% } %>
                <button type="submit" class="btn btn-primary btn-sm mt-2 w-100">Search</button>
              </form>
            </div>
            
            <!-- Categories -->
            <div class="filter-group">
              <h6><i class="bi bi-grid me-2"></i>Categories</h6>
              <div class="filter-list">
                <a href="/products" class="filter-item <%= !currentCategory ? 'active' : '' %>">
                  All Products
                </a>
                <% if (typeof categories !== 'undefined') { %>
                  <% categories.forEach(cat => { %>
                    <a href="/products?category=<%= encodeURIComponent(cat) %>" 
                       class="filter-item <%= currentCategory === cat ? 'active' : '' %>">
                      <%= cat %>
                    </a>
                  <% }) %>
                <% } %>
              </div>
            </div>

            <!-- Sort -->
            <div class="filter-group">
              <h6><i class="bi bi-sort-down me-2"></i>Sort By</h6>
              <div class="filter-list">
                <a href="/products?<%= currentCategory ? 'category=' + encodeURIComponent(currentCategory) + '&' : '' %><%= currentSearch ? 'search=' + encodeURIComponent(currentSearch) + '&' : '' %>sort=price-low" 
                   class="filter-item <%= currentSort === 'price-low' ? 'active' : '' %>">Price: Low to High</a>
                <a href="/products?<%= currentCategory ? 'category=' + encodeURIComponent(currentCategory) + '&' : '' %><%= currentSearch ? 'search=' + encodeURIComponent(currentSearch) + '&' : '' %>sort=price-high" 
                   class="filter-item <%= currentSort === 'price-high' ? 'active' : '' %>">Price: High to Low</a>
                <a href="/products?<%= currentCategory ? 'category=' + encodeURIComponent(currentCategory) + '&' : '' %><%= currentSearch ? 'search=' + encodeURIComponent(currentSearch) + '&' : '' %>sort=name" 
                   class="filter-item <%= currentSort === 'name' ? 'active' : '' %>">Name: A to Z</a>
                <a href="/products?<%= currentCategory ? 'category=' + encodeURIComponent(currentCategory) + '&' : '' %><%= currentSearch ? 'search=' + encodeURIComponent(currentSearch) + '&' : '' %>sort=popular" 
                   class="filter-item <%= currentSort === 'popular' ? 'active' : '' %>">Most Popular</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="col-lg-9">
        <div class="products-header d-flex justify-content-between align-items-center mb-4">
          <p class="mb-0 text-muted">
            Showing <strong><%= total %></strong> product<%= total !== 1 ? 's' : '' %>
            <% if (currentCategory) { %> in <strong><%= currentCategory %></strong><% } %>
            <% if (currentSearch) { %> for "<strong><%= currentSearch %></strong>"<% } %>
          </p>
        </div>

        <% if (products.length > 0) { %>
          <div class="row g-3 g-md-4">
            <% products.forEach(product => { %>
              <div class="col-6 col-md-4">
                <%- include('partials/product-card', { product }) %>
              </div>
            <% }) %>
          </div>

          <!-- Pagination -->
          <% if (totalPages > 1) { %>
            <nav class="mt-5">
              <ul class="pagination justify-content-center">
                <li class="page-item <%= currentPage <= 1 ? 'disabled' : '' %>">
                  <a class="page-link" href="/products?page=<%= currentPage - 1 %><%= currentCategory ? '&category=' + encodeURIComponent(currentCategory) : '' %><%= currentSearch ? '&search=' + encodeURIComponent(currentSearch) : '' %><%= currentSort ? '&sort=' + currentSort : '' %>">
                    <i class="bi bi-chevron-left"></i>
                  </a>
                </li>
                <% for (let i = 1; i <= totalPages; i++) { %>
                  <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                    <a class="page-link" href="/products?page=<%= i %><%= currentCategory ? '&category=' + encodeURIComponent(currentCategory) : '' %><%= currentSearch ? '&search=' + encodeURIComponent(currentSearch) : '' %><%= currentSort ? '&sort=' + currentSort : '' %>"><%= i %></a>
                  </li>
                <% } %>
                <li class="page-item <%= currentPage >= totalPages ? 'disabled' : '' %>">
                  <a class="page-link" href="/products?page=<%= currentPage + 1 %><%= currentCategory ? '&category=' + encodeURIComponent(currentCategory) : '' %><%= currentSearch ? '&search=' + encodeURIComponent(currentSearch) : '' %><%= currentSort ? '&sort=' + currentSort : '' %>">
                    <i class="bi bi-chevron-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
          <% } %>
        <% } else { %>
          <div class="empty-state">
            <i class="bi bi-search"></i>
            <h4>No products found</h4>
            <p>Try adjusting your filters or search terms</p>
            <a href="/products" class="btn btn-primary">View All Products</a>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</section>

<%- include('partials/footer') %>
